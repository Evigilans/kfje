apiVersion: v1
kind: ConfigMap
metadata:
  name: database-configmap
data:
  POSTGRES_DATABASE: "postgres"
  init.sql: |
    CREATE TABLE IF NOT EXISTS users
    (
    user_id         bigint        NOT NULL,
    username        varchar(40)   NOT NULL,
    amount_of_posts int DEFAULT 0 NOT NULL,
    CONSTRAINT users_pkey PRIMARY KEY (user_id)
    );
    
    ALTER TABLE users
    OWNER TO postgres;
    
    CREATE SEQUENCE users_seq INCREMENT BY 50;
    
    ALTER SEQUENCE users_seq OWNER TO postgres;
    
    CREATE TABLE IF NOT EXISTS posts
    (
    post_id   bigint                    NOT NULL,
    author_id bigint                    NOT NULL,
    text      text                      NOT NULL,
    posted_at date DEFAULT CURRENT_DATE NOT NULL,
    CONSTRAINT posts_pkey PRIMARY KEY (post_id)
    );
    
    ALTER TABLE posts
    OWNER TO postgres;
    
    CREATE SEQUENCE posts_seq INCREMENT BY 50;
    
    ALTER SEQUENCE posts_seq OWNER TO postgres;
    
    INSERT INTO users
    VALUES (1, 'Alex', 2);

    INSERT INTO users
    VALUES (2, 'Paul', 0);

    INSERT INTO users
    VALUES (3, 'Mike', 1);

    INSERT INTO users
    VALUES (4, 'Steve', 1);

    SELECT setval('users_seq', 100, true);

    INSERT INTO posts
    VALUES (1, 1, 'Hi friends, I recently watched amazing movie at the cinema', '2023-04-21');

    INSERT INTO posts
    VALUES (2, 1, 'Hi friends, I changed the topic of my post', '2023-04-23');

    INSERT INTO posts
    VALUES (3, 3, 'Hi friends, I changed the topic of my post', '2023-04-19');

    INSERT INTO posts
    VALUES (4, 4, 'Hi friends, I recently watched amazing movie at the cinema', '2023-02-01');

    SELECT setval('posts_seq', 100, true);
